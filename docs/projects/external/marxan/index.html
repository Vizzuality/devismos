<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Marxan - Devismos</title> <link rel="shortcut icon" href="/devismos/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/devismos/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/devismos/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/devismos/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Marxan | Devismos</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="Marxan" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Review of GraphQL for the Marxan cloud platform" /> <meta property="og:description" content="Review of GraphQL for the Marxan cloud platform" /> <link rel="canonical" href="/devismos/docs/projects/external/marxan/" /> <meta property="og:url" content="/devismos/docs/projects/external/marxan/" /> <meta property="og:site_name" content="Devismos" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2021-10-29T12:24:50+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Marxan" /> <script type="application/ld+json"> {"description":"Review of GraphQL for the Marxan cloud platform","url":"/devismos/docs/projects/external/marxan/","@type":"BlogPosting","headline":"Marxan","dateModified":"2021-10-29T12:24:50+00:00","datePublished":"2021-10-29T12:24:50+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"/devismos/docs/projects/external/marxan/"},"@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/devismos/" class="site-title lh-tight"> Devismos </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/devismos/docs/onboarding/index/" class="nav-list-link">Onboarding</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/guidelines/index/" class="nav-list-link">Guidelines</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/guidelines/how-to-create-initiatives/index/" class="nav-list-link">How to create initiatives</a><ul class="nav-list"><li class="nav-list-item "> <a href="/devismos/docs/guidelines/how-to-create-initiatives/initiative-template/" class="nav-list-link">Initiative template</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/guidelines/frontismos/index/" class="nav-list-link">Frontismos guidelines</a><ul class="nav-list"><li class="nav-list-item "> <a href="/devismos/docs/guidelines/frontismos/hiring/" class="nav-list-link">Hiring process</a> </li><li class="nav-list-item "> <a href="/devismos/docs/guidelines/frontismos/ssr/" class="nav-list-link">Server side rendering</a> </li><li class="nav-list-item "> <a href="/devismos/docs/guidelines/frontismos/vercel/" class="nav-list-link">Vercel</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/guidelines/backenders/index/" class="nav-list-link">Backenders guidelines</a><ul class="nav-list"><li class="nav-list-item "> <a href="/devismos/docs/guidelines/backenders/ci-cd/" class="nav-list-link">CI/CD tools</a> </li><li class="nav-list-item "> <a href="/devismos/docs/guidelines/backenders/email-providers/" class="nav-list-link">Email providers</a> </li><li class="nav-list-item "> <a href="/devismos/docs/guidelines/backenders/setting-up-new-nestjs-projects/" class="nav-list-link">NestJS for Vizzuality projects</a> </li></ul></li><li class="nav-list-item "><a href="/devismos/docs/guidelines/computer-choice/" class="nav-list-link">Computer choice</a></li><li class="nav-list-item "><a href="/devismos/docs/guidelines/error-page/" class="nav-list-link">Error page</a></li><li class="nav-list-item "><a href="/devismos/docs/guidelines/github/" class="nav-list-link">Github</a></li><li class="nav-list-item "><a href="/devismos/docs/guidelines/mob-sessions/" class="nav-list-link">Mob sessions</a></li><li class="nav-list-item "><a href="/devismos/docs/guidelines/standardization/" class="nav-list-link">Standardization</a></li><li class="nav-list-item "><a href="/devismos/docs/guidelines/testing/" class="nav-list-link">Testing</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/backenders/index/" class="nav-list-link">Backenders</a><ul class="nav-list "><li class="nav-list-item "><a href="/devismos/docs/backenders/how-we-work/index/" class="nav-list-link">How we work</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/backenders/recurrent-activities/index/" class="nav-list-link">Recurrent Activities</a><ul class="nav-list"></ul></li><li class="nav-list-item "><a href="/devismos/docs/backenders/resources/index/" class="nav-list-link">Resources</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/backenders/strategy-2021/index/" class="nav-list-link">Strategy 2021</a><ul class="nav-list"><li class="nav-list-item "> <a href="/devismos/docs/backenders/strategy-2021/funtional-areas/index/" class="nav-list-link">Functional areas</a> </li><li class="nav-list-item "> <a href="/devismos/docs/backenders/strategy-2021/initiatives-directory/index/" class="nav-list-link">Initiatives directory</a> </li><li class="nav-list-item "> <a href="/devismos/docs/backenders/strategy-2021/operational-needs/" class="nav-list-link">Operational needs</a> </li><li class="nav-list-item "> <a href="/devismos/docs/backenders/strategy-2021/quality-goals/" class="nav-list-link">Quality goals</a> </li><li class="nav-list-item "> <a href="/devismos/docs/backenders/strategy-2021/roles/index/" class="nav-list-link">Roles</a> </li><li class="nav-list-item "> <a href="/devismos/docs/backenders/strategy-2021/strategy-priorities/" class="nav-list-link">Strategy priorities</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/frontismos/index/" class="nav-list-link">Frontismos</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/frontismos/recurrent-activities/index/" class="nav-list-link">Recurrent activities</a><ul class="nav-list"><li class="nav-list-item "> <a href="/devismos/docs/frontismos/recurrent-activities/montly-report/" class="nav-list-link">Monthly report with Sergio</a> </li><li class="nav-list-item "> <a href="/devismos/docs/frontismos/recurrent-activities/frontismos-meetings/" class="nav-list-link">Weekly Frontismos meetings</a> </li><li class="nav-list-item "> <a href="/devismos/docs/frontismos/recurrent-activities/capacity-meetings/" class="nav-list-link">Weekly capacity meetings</a> </li><li class="nav-list-item "> <a href="/devismos/docs/frontismos/recurrent-activities/pair-programming/" class="nav-list-link">Weekly pair programming sessions</a> </li></ul></li><li class="nav-list-item "><a href="/devismos/docs/frontismos/resources/index/" class="nav-list-link">Resources</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/frontismos/strategy-2021/index/" class="nav-list-link">Strategy 2021</a><ul class="nav-list"><li class="nav-list-item "> <a href="/devismos/docs/frontismos/strategy-2021/funtional-areas/index/" class="nav-list-link">Functional areas</a> </li><li class="nav-list-item "> <a href="/devismos/docs/frontismos/strategy-2021/initiatives-directory/hiring-proposal/" class="nav-list-link">Hiring proposal</a> </li><li class="nav-list-item "> <a href="/devismos/docs/frontismos/strategy-2021/initiatives-directory/index/" class="nav-list-link">Initiatives directory</a> </li><li class="nav-list-item "> <a href="/devismos/docs/frontismos/strategy-2021/operational-needs/" class="nav-list-link">Operational needs</a> </li><li class="nav-list-item "> <a href="/devismos/docs/frontismos/strategy-2021/quality-goals/" class="nav-list-link">Quality goals</a> </li><li class="nav-list-item "> <a href="/devismos/docs/frontismos/strategy-2021/roles/index/" class="nav-list-link">Roles</a> </li><li class="nav-list-item "> <a href="/devismos/docs/frontismos/strategy-2021/strategy-priorities/" class="nav-list-link">Strategy priorities</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/meetings-notes/index/" class="nav-list-link">Meeting notes</a><ul class="nav-list "><li class="nav-list-item "><a href="/devismos/docs/meetings-notes/be-capacity/index/" class="nav-list-link">Backend</a></li><li class="nav-list-item "><a href="/devismos/docs/meetings-notes/sci-time/index/" class="nav-list-link">Sci-time</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/meetings-notes/devismos/index/" class="nav-list-link">Devismos</a><ul class="nav-list"><li class="nav-list-item "> <a href="/devismos/docs/meetings-notes/devismos/2020-11-10/" class="nav-list-link">2020-10-02</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/meetings-notes/frontismos/index/" class="nav-list-link">Frontismos notes</a><ul class="nav-list"><li class="nav-list-item "> <a href="/devismos/docs/meetings-notes/frontismos/2020-01-03-new-years-resolution/" class="nav-list-link">2020-01-03</a> </li><li class="nav-list-item "> <a href="/devismos/docs/meetings-notes/frontismos/2020-01-10-react-canvas-maps/" class="nav-list-link">2020-01-10</a> </li><li class="nav-list-item "> <a href="/devismos/docs/meetings-notes/frontismos/2020-01-17-sergios-role-shaky-connections/" class="nav-list-link">2020-01-17</a> </li><li class="nav-list-item "> <a href="/devismos/docs/meetings-notes/frontismos/2020-01-24-state-of-maps/" class="nav-list-link">2020-01-24</a> </li><li class="nav-list-item "> <a href="/devismos/docs/meetings-notes/frontismos/2020-10-30-the-lab-QA-mapbox3d-typescript-testing/" class="nav-list-link">2020-01-30</a> </li><li class="nav-list-item "> <a href="/devismos/docs/meetings-notes/frontismos/2020-11-24-capacity-strategy-community/" class="nav-list-link">2020-11-24</a> </li></ul></li><li class="nav-list-item "><a href="/devismos/docs/meetings-notes/i-like-your-apis/index/" class="nav-list-link">I like your APIs</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/projects/index/" class="nav-list-link">Projects</a><ul class="nav-list "><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/projects/external/index/" class="nav-list-link">External projects</a><ul class="nav-list"><li class="nav-list-item active"> <a href="/devismos/docs/projects/external/marxan/" class="nav-list-link active">Marxan</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/projects/internal/index/" class="nav-list-link">Internal projects</a><ul class="nav-list"><li class="nav-list-item "> <a href="/devismos/docs/projects/internal/layer-manager/" class="nav-list-link">Layer Manager</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/researches/index/" class="nav-list-link">Researches</a><ul class="nav-list "><li class="nav-list-item "><a href="/devismos/docs/researches/handling-uploads/" class="nav-list-link">Handling uploads on shaky connections</a></li><li class="nav-list-item "><a href="/devismos/docs/researches/next-auth/" class="nav-list-link">Next Auth implementation with JWT API</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/sciteam/index/" class="nav-list-link">Science Team</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/sciteam/recurrent-activities/index/" class="nav-list-link">Recurrent activities</a><ul class="nav-list"><li class="nav-list-item "> <a href="/devismos/docs/sciteam/recurrent-activities/pairing/" class="nav-list-link">Pair Sharing</a> </li><li class="nav-list-item "> <a href="/devismos/docs/sciteam/recurrent-activities/capacity-meetings/" class="nav-list-link">Weekly capacity meetings</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/sciteam/resources/index/" class="nav-list-link">Resources</a><ul class="nav-list"><li class="nav-list-item "> <a href="/devismos/docs/sciteam/resources/create-role/" class="nav-list-link">Creating & Updating Roles</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/sciteam/roles/index/" class="nav-list-link">Roles</a><ul class="nav-list"><li class="nav-list-item "> <a href="/devismos/docs/sciteam/roles/bd-rep/" class="nav-list-link">BD Representative</a> </li><li class="nav-list-item "> <a href="/devismos/docs/sciteam/roles/capacity/" class="nav-list-link">Capacity</a> </li><li class="nav-list-item "> <a href="/devismos/docs/sciteam/roles/standardisation-quality/" class="nav-list-link">Standardisation & Quality</a> </li><li class="nav-list-item "> <a href="/devismos/docs/sciteam/roles/strategy/" class="nav-list-link">Strategy</a> </li><li class="nav-list-item "> <a href="/devismos/docs/sciteam/roles/support/" class="nav-list-link">Support & Growth</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/devismos/docs/sciteam/strategy-2021/index/" class="nav-list-link">Strategy 2021</a><ul class="nav-list"><li class="nav-list-item "> <a href="/devismos/docs/sciteam/strategy-2021/funtional-areas/index/" class="nav-list-link">Functional area interaction</a> </li><li class="nav-list-item "> <a href="/devismos/docs/sciteam/strategy-2021/initiatives-directory/index/" class="nav-list-link">Initiatives directory</a> </li></ul></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Devismos" aria-label="Search Devismos" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/devismos/docs/projects/index/">Projects</a></li> <li class="breadcrumb-nav-list-item"><a href="/devismos/docs/projects/external/index/">External projects</a></li> <li class="breadcrumb-nav-list-item"><span>Marxan</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="review-of-graphql-for-the-marxan-cloud-platform"> <a href="#review-of-graphql-for-the-marxan-cloud-platform" class="anchor-heading" aria-labelledby="review-of-graphql-for-the-marxan-cloud-platform"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Review of GraphQL for the Marxan cloud platform </h1> <p>Some key points from my deep dive into the GraphQL ecosystem.</p> <h2 id="the-tldr"> <a href="#the-tldr" class="anchor-heading" aria-labelledby="the-tldr"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The TL;DR </h2> <ul> <li>JSON:API and GraphQL should both be a good fit for the project</li> <li>frontend devs should be able to reuse some existing components/strategies if using JSON:API, and have experience with JSON:API</li> <li>the API framework we are using for Marxan (NestJS, also used in Wildlife Insights and Mars MGIS) natively supports GraphQL and we have experience and reusable code for GraphQL, from Wildlife Insights</li> <li>JSON:API would need to be integrated into NestJS via a TypeScript implementation of the JSON:API specification (we may need to do some research via proofs of concept)</li> <li>(we also used GraphQL via Apollo for the Wildlife Insights frontend, so we may be able to reuse code or at least strategies from this)</li> <li>JSON:API relies on familiar HTTP and REST concepts</li> <li>GraphQL departs in several ways from HTTP and REST concepts</li> <li>GraphQL allows to focus on strict typing and on a schema-first approach</li> <li>(optionally, GraphQL schema and types can integrate with TypeScript type definitions)</li> <li>a GraphQL schema should allow us to create a mock API quickly, via <code class="language-plaintext highlighter-rouge">graphql-faker</code></li> <li>Both JSON:API and GraphQL in practice require client and server tooling</li> </ul> <h2 id="my-recommendation"> <a href="#my-recommendation" class="anchor-heading" aria-labelledby="my-recommendation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> My recommendation </h2> <p>I recommend that we use GraphQL. Despite the likely initial higher ramp-up for frontend development, we should be able to reap benefits in terms of development ergonomics over the timespan of the project.</p> <p>Bias disclaimer: although I did my homework reading the JSON:API specification, I have no production experience with JSON:API and I was very happy with GraphQL in Wildlife Insights (and in some pre-Vizz Gatsby projects).</p> <p>I expect that handling JSON:API with NestJS through one of the TypeScript JSON:API implementations should be reasonably doable, but here be dragons - we won’t be able to rely on an existing NestJS plugin.</p> <h2 id="a-deeper-dive"> <a href="#a-deeper-dive" class="anchor-heading" aria-labelledby="a-deeper-dive"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> A deeper dive </h2> <p>First, a quick example. We will create a new Git repository/project on the <a href="https://sr.ht/">SourceHut platform</a> via its GraphQL API.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat example.json
mutation createRepository($name: String!, $description: String) {
  createRepository(name: $name, visibility: PRIVATE, description: $description) {
    id
    updated
    owner {
      canonicalName
    }
  }
}

$ curl -X POST -H 'Authorization: Bearer &lt;token&gt;' \
    -H 'Content-Type: application/graphql'
    -d @example.json
    'https://git.sr.ht/query?variables={"name": "marxan-cloud-ftw", "description": "Components for the MarxanCloud platform"}' | jq
{
  "data": {
    "createRepository": {
      "id": 12345,
      "updated": "2020-12-09T10:07:00Z",
      "owner": {
        "canonicalName": "~hotzevzl"
      }
    }
  }
}
</code></pre></div></div> <p>Although this is a very simple example, we can nevertheless observe some key traits of a typical GraphQL API which are relevant for a review of key differences from REST-ish APIs.</p> <ul> <li>In simplest use cases, GraphQL is “just JSON over HTTP”</li> </ul> <p>In practice, client and server libraries are needed to do most of the heavy lifting (similarly to client and server implementations of the JSON:API spec), but in essence the interface between GraphQL clients and servers is mostly a pipeline of JSON documents (requests and response) over HTTP: for very simple interactions, even plain requests via cURL will work fine.</p> <ul> <li>Requests typically hit a single “endpoint”</li> </ul> <p>In this example, the endpoint is <code class="language-plaintext highlighter-rouge">https://git.sr.ht/query</code>.</p> <p>This acts effectively as an “entry point” to the entire GraphQL API, through which all the client request are channeled.</p> <p>Meaningful, consistent and elegant URI design, which is typically a core part of a REST API, does not really apply to GraphQL. All the naming semantics are conveyed through the GraphQL payload (above shown as raw GraphQL query, but typically encapsulated in a JSON file which contains both query <em>and</em> variables).</p> <p>In a REST API, a request similar to the example above, to create a new repository, would be done via something like <code class="language-plaintext highlighter-rouge">POST /api/v1/repositories</code>, with a JSON payload describing the resource that we are trying to create.</p> <ul> <li>HTTP is used as a “dumb” transport channel</li> </ul> <p>All requests use a single HTTP verb (typically, <code class="language-plaintext highlighter-rouge">POST</code>: <code class="language-plaintext highlighter-rouge">GET</code> may be used to <em>query</em> data only, not to <em>mutate</em> data), besides using a single “endpoint”.</p> <p>This is a major departure from the consistent use of key HTTP verbs in REST APIs.</p> <ul> <li>GraphQL is kind of RPC</li> </ul> <p>In their simplest form, GraphQL queries do indeed feel declarative; for example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>query {
  me {
    canonicalName
  }
}
</code></pre></div></div> <p>However, they can be augmented with <em>parameters</em> which may describe server-side operations of arbitrary complexity; such as plain filters in the example below (<code class="language-plaintext highlighter-rouge">repositories(filter: { count: 2 }</code>):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>query {
  me {
    canonicalName
    repositories(filter: { count: 2 }) {
      cursor
      results {
        id, name, updated
      }
    }
  }
}
</code></pre></div></div> <p>Or stateful cursors for paginated result sets such as in the example below:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>query {
  me {
    canonicalName
    repositories(cursor: "&lt;long string with cursor&gt;") {
      cursor
      results {
        id, name, updated
      }
    }
  }
}
</code></pre></div></div> <p>In my view, GraphQL allows to hit a sweet spot between the meaningful manipulation of representations of resources as typically done in REST APIs, and the potential expressiveness and flexibility of RPC interfaces, yet without forcing to work within the complexity of more elaborate RPC systems (for those still having SOAP or XML-RPC nightmares from the 2000s).</p> <ul> <li>GraphQL enforces strongly typed schemas</li> </ul> <p>Although it is indeed possible to create GraphQL schemas that only use basic scalar types (such as <code class="language-plaintext highlighter-rouge">String</code>, <code class="language-plaintext highlighter-rouge">Int</code>, <code class="language-plaintext highlighter-rouge">Float</code>, <code class="language-plaintext highlighter-rouge">Boolean</code>), in practice this would hardly be useful: most often, expressive types are created and composed.</p> <p>Union types, interfaces, enums are commonly used to curate expressive API graphs.</p> <p>“Making impossible states impossible” through strong typing is indeed a major advantage of the GraphQL query language.</p> <p>In the example above, the <code class="language-plaintext highlighter-rouge">createRepository()</code> mutation accepts one required string parameter (<code class="language-plaintext highlighter-rouge">name</code>) and one optional string parameter (<code class="language-plaintext highlighter-rouge">description</code>), and makes use of an enum type for the <code class="language-plaintext highlighter-rouge">visibility</code> parameter.</p> <p>Query payloads that don’t validate against the schema are outright rejected (and GraphQL tooling can help to avoid even creating invalid payloads, especially if coupled with TypeScript typing).</p> <ul> <li>Caching is… different</li> </ul> <p>A major point for GraphQL skepticism, but likely in practice not all that relevant in projects like the Marxan cloud platform.</p> <p>GraphQL queries (as opposed to mutations and subscriptions) could indeed be cached by using the <code class="language-plaintext highlighter-rouge">GET</code>-verb endpoint, companion to the <code class="language-plaintext highlighter-rouge">POST</code> one normally used (with some caveats).</p> <p>In practice, for authenticated GraphQL APIs where query results may be different for each authenticated user, even this may not be a major issue, especially when combined with application-level caching strategies, which are available at different levels of granularity (from whole-request down to individual fields).</p> <p>Several common caching strategies are implemented in major GraphQL client and server implementations, making it possible to rely on existing best practices and keeping development complexity under control.</p> <p>Moreover, expensive queries that need to be exposed to non-authenticated users could also be made available over ad-hoc REST endpoints, thus allowing to enjoy the benefits of HTTP-layer gateway caching.</p> <h2 id="some-more-points-to-consider"> <a href="#some-more-points-to-consider" class="anchor-heading" aria-labelledby="some-more-points-to-consider"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Some more points to consider </h2> <p>More traits of GraphQL API practices cannot be gleaned from the initial example above. I am briefly outlining here the ones that are, in my opinion, most relevant to the Marxan cloud platform scenario.</p> <ul> <li>Authentication is often kept as a REST subsystem</li> </ul> <p>This seems to be common practice, and allows to use different established authentication strategies (e.g. password authentication, 2FA, OAuth2, etc.).</p> <p>Once a token or key of some sort is obtained, this can be used in HTTP headers as commonly done in <code class="language-plaintext highlighter-rouge">Bearer</code> type authorization strategies or equivalent.</p> <ul> <li>Introspection augments the type system</li> </ul> <p>In practice, this is often used to provide functionality similar to what OpenAPI interfaces do; in the case of GraphQL, documentation of the whole API graph is consistently done via introspection, so the GraphQL schema serves both as parsing, validation and query processing layer as well as documentation layer (the same may be true in some OpenAPI server implementations, in practice).</p> <p>Documentation on <em>how to use</em> a GraphQL API is typically still needed like with most non-trivial APIs, although the type system combined with introspection and meaningful naming of queries, mutations and parameters provides a convenient core documentation layer.</p> <ul> <li>Authorization</li> </ul> <p>Fine-grained access control is pretty much equally doable via REST and GraphQL.</p> <p>For example, only allowing users with a specific role to set or modify specific fields, or to set them to specific values under specific circumstances, or to query specific fields.</p> <p>GraphQL may make some access control rules more expressive (for example, by using access decorators in the schema definition) and easier to understand at a glance, although I would argue this is mostly a tooling concern as well as a matter of preference.</p> <ul> <li>N+1 problem</li> </ul> <p>GraphQL resolvers by default typically traverse a query graph node by node, depth-first and may process each node in isolation, which could easily lead to very inefficient database queries (defaults are actually up to server implementations - this would be a worst-case scenario).</p> <p>GraphQL server implementations may provide, either as core functionality or through a library/module, lazy loading/async/batching functionality which essentially traverses the whole query graph (or parts of it), compiling a query plan and eventually executing this to load data from database through the least possible number of queries (simplifying things a bit here).</p> <p>This pattern (“DataLoader”) may limit the ability to compute/estimate cost of individual resolvers, so in case of very complex query graphs, things will still need to be optimised for a sane balance between query performance and the ability to constrain queries whose computational cost is considered unacceptable for the specific context.</p> <ul> <li>API Versioning</li> </ul> <p>A common strategy seems to be evolutive versioning, or basically deprecating affected fields (the GraphQL schema description language provides a <code class="language-plaintext highlighter-rouge">@Deprecated</code> directive for this) and introducing their eventual replacements, while keeping the deprecated ones in place until it is possible/reasonable to break existing API contracts.</p> <ul> <li>Errors</li> </ul> <p>Besides sidestepping the semantics of HTTP verbs besides <code class="language-plaintext highlighter-rouge">GET</code> and <code class="language-plaintext highlighter-rouge">POST</code>, GraphQL also handles errors differently than via HTTP status codes. In practice, client and server implementations take care of error handling similarly to how HTTP status codes would be handled by REST frameworks. Additionally, GraphQL error handling can be granular, for example surfacing different kinds of errors as they apply to different parts of a query.</p> <ul> <li>Federation</li> </ul> <p>GraphQL APIs for distinct microservices can be federated at the API layer itself (e.g. via Apollo Federation), essentially providing a GraphQL-focused gateway that allows clients to see a single GraphQL API even though parts of its functionality may be provided by independent microservices.</p> <p>We didn’t use nor needed this functionality in Wildlife Insights, but as we are likely going to rely on a small set of microservices for data processing operations, this could be a useful feature for the Marxan cloud platform. We could of course equally do some ad-hoc lightweight proxying of REST requests in the API.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
